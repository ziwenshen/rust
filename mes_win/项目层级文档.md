# 项目层级文档

## 项目概述

这是一个基于 **Tauri + Yew** 的桌面应用程序项目，采用 Rust 语言开发。项目使用了现代化的 Web 技术栈构建用户界面，并通过 Tauri 框架实现跨平台桌面应用。

- **前端框架**: Yew (Rust 的 WebAssembly 框架)
- **桌面框架**: Tauri v2
- **构建工具**: Trunk (用于 Yew 项目构建)
- **语言**: Rust

## 项目结构详解

### 根目录层级

```
mes_win/                        # 项目根目录
├── Cargo.toml                  # Workspace 配置文件
├── Cargo.lock                  # 依赖锁定文件
├── index.html                  # 前端入口 HTML 文件
├── README.md                   # 项目说明文档
├── styles.css                  # 全局样式文件
├── Trunk.toml                  # Trunk 构建工具配置
├── public/                     # 静态资源目录
├── src/                        # 前端源代码目录 (Yew 应用)
├── src-tauri/                  # 桌面应用后端 (Tauri 原生层)
└── target/                     # 编译输出目录
```

### 1. 核心配置文件

#### `Cargo.toml` (根目录)
- **作用**: Workspace 根配置文件
- **关键配置**:
  - 定义前端 Yew 应用的依赖 (`yew`, `wasm-bindgen`, `web-sys` 等)
  - 配置 workspace 成员，包含 `src-tauri` 子项目
  - 包名: `mes_win-ui`

#### `Trunk.toml`
- **作用**: Trunk 构建工具配置
- **关键配置**:
  - 构建目标: `./index.html`
  - 开发服务器端口: 1420
  - 监听忽略目录: `./src-tauri`

#### `index.html`
- **作用**: 应用入口 HTML 文件
- **功能**: 定义页面结构，引入样式表和静态资源

### 2. 前端层 (`src/` 目录)

```
src/
├── main.rs                     # 前端应用入口点
└── app.rs                      # 主应用组件
```

- **技术栈**: Yew + WebAssembly
- **功能**: 负责用户界面渲染和交互逻辑
- **编译目标**: WebAssembly (运行在 Tauri 的 WebView 中)

### 3. 桌面应用后端 (`src-tauri/` 目录)

```
src-tauri/
├── Cargo.toml                  # Tauri 应用配置
├── build.rs                    # 构建脚本
├── tauri.conf.json            # Tauri 框架配置
├── src/
│   ├── main.rs                # 后端应用入口
│   └── lib.rs                 # 核心业务逻辑库
├── capabilities/              # 权限配置
├── gen/                       # 自动生成的配置文件
└── icons/                     # 应用图标资源
```

#### `src-tauri/` 目录详细解释

**这是 Tauri 桌面应用的核心**，负责以下关键功能：

##### 🖥️ **原生桌面应用层**
- **窗口管理**: 创建、调整、控制应用窗口
- **系统集成**: 访问文件系统、系统通知、托盘图标等
- **原生性能**: 直接调用操作系统 API，获得原生应用性能

##### 🔗 **前后端桥梁**
- **Tauri Commands**: 定义可从前端调用的 Rust 函数
- **事件系统**: 处理前端事件，向前端发送系统事件
- **数据传输**: 在 WebView（前端）和原生代码（后端）之间传输数据

##### 📋 **具体职责分工**

| 组件 | 职责 | 示例功能 |
|------|------|----------|
| **前端 (`src/`)** | 用户界面 | 按钮点击、表单输入、数据展示 |
| **后端 (`src-tauri/`)** | 系统功能 | 文件读写、网络请求、系统调用 |

##### 🛠️ **工作原理**

1. **前端发起调用**: Yew 组件调用 Tauri API
   ```rust
   // 前端 JavaScript/WebAssembly 调用
   invoke('greet', { name: 'World' })
   ```

2. **后端处理请求**: Rust 函数处理业务逻辑
   ```rust
   // src-tauri/src/lib.rs 中的函数
   #[tauri::command]
   fn greet(name: &str) -> String {
       format!("Hello, {}! You've been greeted from Rust!", name)
   }
   ```

3. **返回结果**: 将处理结果返回给前端界面

##### 🎯 **为什么这样设计？**

- **安全性**: 敏感操作在原生代码中进行，不暴露给 Web 层
- **性能**: 计算密集型任务使用 Rust 处理，比 JavaScript 更快
- **能力**: 可以访问 Web 技术无法直接访问的系统功能
- **跨平台**: 同一套 Rust 代码可在 Windows、macOS、Linux 运行

#### 关键文件说明:

- **`Cargo.toml`**: 
  - 包名: `mes_win`
  - 依赖: `tauri`, `tauri-plugin-opener`, `serde` 等
  - 构建类型: `staticlib`, `cdylib`, `rlib`

- **`src/main.rs`**: 应用启动入口
- **`src/lib.rs`**: 核心业务逻辑库
- **`tauri.conf.json`**: Tauri 应用的详细配置

### 4. 静态资源层 (`public/` 目录)

```
public/
├── tauri.svg                   # Tauri 官方图标
└── yew.png                     # Yew 框架图标
```

- **作用**: 存放静态资源文件
- **处理方式**: 通过 Trunk 的 `copy-dir` 指令复制到构建输出

### 5. 构建输出层 (`target/` 目录)

```
target/
├── debug/                      # Debug 模式构建输出
│   ├── *.exe                   # Windows 可执行文件
│   ├── *.dll                   # 动态链接库
│   ├── *.rlib                  # Rust 库文件
│   ├── build/                  # 依赖构建缓存
│   └── deps/                   # 依赖文件
├── wasm-bindgen/               # WebAssembly 绑定文件
└── wasm32-unknown-unknown/     # WASM 目标构建输出
```

## 技术架构层次

### 第一层: 用户界面层
- **技术**: HTML + CSS + Yew (Rust → WebAssembly)
- **职责**: 用户交互、界面渲染、状态管理

### 第二层: 应用框架层
- **技术**: Tauri Framework
- **职责**: WebView 管理、前后端通信、系统 API 访问

### 第三层: 系统接口层
- **技术**: Rust + 系统 API
- **职责**: 文件系统访问、网络通信、系统资源管理

### 第四层: 操作系统层
- **支持**: Windows, macOS, Linux
- **功能**: 跨平台桌面应用运行环境

## 开发工作流

1. **前端开发**: 在 `src/` 目录中使用 Yew 框架开发 UI 组件
2. **后端开发**: 在 `src-tauri/src/` 中开发 Rust 业务逻辑
3. **构建测试**: 使用 `cargo tauri dev` 启动开发环境
4. **生产构建**: 使用 `cargo tauri build` 生成发布版本

## 依赖管理

### 前端依赖 (根目录 `Cargo.toml`)
- `yew`: Web 框架
- `wasm-bindgen`: WebAssembly 绑定
- `web-sys`, `js-sys`: Web API 绑定
- `serde`: 序列化/反序列化

### 后端依赖 (`src-tauri/Cargo.toml`)
- `tauri`: 桌面应用框架
- `tauri-plugin-opener`: 文件打开插件
- `serde`, `serde_json`: 数据处理

## 特点总结

1. **模块化设计**: 前后端分离，各自独立开发和构建
2. **类型安全**: 全栈 Rust 开发，编译时类型检查
3. **高性能**: WebAssembly 前端 + 原生 Rust 后端
4. **跨平台**: 支持 Windows、macOS、Linux
5. **现代化**: 使用最新的 Web 技术和 Rust 生态

这种架构既保持了 Web 技术的灵活性，又获得了原生应用的性能和系统访问能力。
